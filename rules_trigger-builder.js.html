<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>rules/trigger-builder.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="actions.html">actions</a><ul class='members'><li data-type='member'><a href="actions.html#.Audio">Audio</a></li><li data-type='member'><a href="actions.html#.BusEvent">BusEvent</a></li><li data-type='member'><a href="actions.html#.Ephemeris">Ephemeris</a></li><li data-type='member'><a href="actions.html#.Exec">Exec</a></li><li data-type='member'><a href="actions.html#.HTTP">HTTP</a></li><li data-type='member'><a href="actions.html#.Log">Log</a></li><li data-type='member'><a href="actions.html#.Ping">Ping</a></li><li data-type='member'><a href="actions.html#.ScriptExecution">ScriptExecution</a></li><li data-type='member'><a href="actions.html#.Semantics">Semantics</a></li><li data-type='member'><a href="actions.html#.Things">Things</a></li><li data-type='member'><a href="actions.html#.Voice">Voice</a></li><li data-type='member'><a href="actions.html#.NotificationAction">NotificationAction</a></li></ul><ul class='methods'><li data-type='method'><a href="actions.html#.exports.thingActions">exports.thingActions</a></li></ul></li><li><a href="cache.html">cache</a><ul class='methods'><li data-type='method'><a href="cache.html#.get">get</a></li><li data-type='method'><a href="cache.html#.put">put</a></li><li data-type='method'><a href="cache.html#.remove">remove</a></li><li data-type='method'><a href="cache.html#.exists">exists</a></li></ul></li><li><a href="items.html">items</a><ul class='members'><li data-type='member'><a href="items.html#.DYNAMIC_ITEM_TAG">DYNAMIC_ITEM_TAG</a></li></ul><ul class='methods'><li data-type='method'><a href="items.html#.addItem">addItem</a></li><li data-type='method'><a href="items.html#.removeItem">removeItem</a></li><li data-type='method'><a href="items.html#.replaceItem">replaceItem</a></li><li data-type='method'><a href="items.html#.getItem">getItem</a></li><li data-type='method'><a href="items.html#.getItems">getItems</a></li><li data-type='method'><a href="items.html#.getItemsByTag">getItemsByTag</a></li><li data-type='method'><a href="items.html#.safeItemName">safeItemName</a></li></ul></li><li><a href="log.html">log</a><ul class='members'><li data-type='member'><a href="log.html#.LOGGER_PREFIX">LOGGER_PREFIX</a></li></ul><ul class='methods'><li data-type='method'><a href="log.html#.newLogger">newLogger</a></li></ul></li><li><a href="metadata.html">metadata</a><ul class='methods'><li data-type='method'><a href="metadata.html#.upsertItemChannelLink">upsertItemChannelLink</a></li><li data-type='method'><a href="metadata.html#.removeItemChannelLink">removeItemChannelLink</a></li><li data-type='method'><a href="metadata.html#.getValue">getValue</a></li><li data-type='method'><a href="metadata.html#.upsertValue">upsertValue</a></li></ul></li><li><a href="osgi.html">osgi</a><ul class='methods'><li data-type='method'><a href="osgi.html#.getService">getService</a></li><li data-type='method'><a href="osgi.html#.findServices">findServices</a></li></ul></li><li><a href="rules.html">rules</a><ul class='methods'><li data-type='method'><a href="rules.html#.when">when</a></li><li data-type='method'><a href="rules.html#.removeRule">removeRule</a></li><li data-type='method'><a href="rules.html#.runRule">runRule</a></li><li data-type='method'><a href="rules.html#.isEnabled">isEnabled</a></li><li data-type='method'><a href="rules.html#.setEnabled">setEnabled</a></li><li data-type='method'><a href="rules.html#.JSRule">JSRule</a></li><li data-type='method'><a href="rules.html#.SwitchableJSRule">SwitchableJSRule</a></li></ul></li><li><a href="things.html">things</a><ul class='methods'><li data-type='method'><a href="things.html#.getThing">getThing</a></li><li data-type='method'><a href="things.html#.getThings">getThings</a></li></ul></li><li><a href="time.html">time</a><ul class='methods'><li data-type='method'><a href="time.html#.toZDT">toZDT</a></li></ul></li><li><a href="triggers.html">triggers</a><ul class='methods'><li data-type='method'><a href="triggers.html#.ChannelEventTrigger">ChannelEventTrigger</a></li><li data-type='method'><a href="triggers.html#.ItemStateChangeTrigger">ItemStateChangeTrigger</a></li><li data-type='method'><a href="triggers.html#.ItemStateUpdateTrigger">ItemStateUpdateTrigger</a></li><li data-type='method'><a href="triggers.html#.ItemCommandTrigger">ItemCommandTrigger</a></li><li data-type='method'><a href="triggers.html#.GroupStateChangeTrigger">GroupStateChangeTrigger</a></li><li data-type='method'><a href="triggers.html#.GroupStateUpdateTrigger">GroupStateUpdateTrigger</a></li><li data-type='method'><a href="triggers.html#.GroupCommandTrigger">GroupCommandTrigger</a></li><li data-type='method'><a href="triggers.html#.ThingStatusUpdateTrigger">ThingStatusUpdateTrigger</a></li><li data-type='method'><a href="triggers.html#.ThingStatusChangeTrigger">ThingStatusChangeTrigger</a></li><li data-type='method'><a href="triggers.html#.SystemStartlevelTrigger">SystemStartlevelTrigger</a></li><li data-type='method'><a href="triggers.html#.GenericCronTrigger">GenericCronTrigger</a></li><li data-type='method'><a href="triggers.html#.TimeOfDayTrigger">TimeOfDayTrigger</a></li><li data-type='method'><a href="triggers.html#.DateTimeTrigger">DateTimeTrigger</a></li><li data-type='method'><a href="triggers.html#.PWMTrigger">PWMTrigger</a></li><li data-type='method'><a href="triggers.html#.PIDTrigger">PIDTrigger</a></li></ul></li><li><a href="utils.html">utils</a><ul class='methods'><li data-type='method'><a href="utils.html#.jsSetToJavaSet">jsSetToJavaSet</a></li><li data-type='method'><a href="utils.html#.jsArrayToJavaSet">jsArrayToJavaSet</a></li><li data-type='method'><a href="utils.html#.jsArrayToJavaList">jsArrayToJavaList</a></li><li data-type='method'><a href="utils.html#.javaListToJsArray">javaListToJsArray</a></li><li data-type='method'><a href="utils.html#.javaSetToJsArray">javaSetToJsArray</a></li><li data-type='method'><a href="utils.html#.javaSetToJsSet">javaSetToJsSet</a></li><li data-type='method'><a href="utils.html#.randomUUID">randomUUID</a></li><li data-type='method'><a href="utils.html#.dumpObject">dumpObject</a></li><li data-type='method'><a href="utils.html#.isJsInstanceOfJava">isJsInstanceOfJava</a></li></ul></li></ul><h3>Classes</h3><ul><li><a href="items.ItemHistory.html">ItemHistory</a><ul class='methods'><li data-type='method'><a href="items.ItemHistory.html#averageBetween">averageBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#averageSince">averageSince</a></li><li data-type='method'><a href="items.ItemHistory.html#changedBetween">changedBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#changedSince">changedSince</a></li><li data-type='method'><a href="items.ItemHistory.html#deltaBetween">deltaBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#deltaSince">deltaSince</a></li><li data-type='method'><a href="items.ItemHistory.html#deviationBetween">deviationBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#deviationSince">deviationSince</a></li><li data-type='method'><a href="items.ItemHistory.html#evolutionRate">evolutionRate</a></li><li data-type='method'><a href="items.ItemHistory.html#evolutionRateBetween">evolutionRateBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#evolutionRateSince">evolutionRateSince</a></li><li data-type='method'><a href="items.ItemHistory.html#historicState">historicState</a></li><li data-type='method'><a href="items.ItemHistory.html#lastUpdate">lastUpdate</a></li><li data-type='method'><a href="items.ItemHistory.html#latestState">latestState</a></li><li data-type='method'><a href="items.ItemHistory.html#maximumBetween">maximumBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#maximumSince">maximumSince</a></li><li data-type='method'><a href="items.ItemHistory.html#minimumBetween">minimumBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#minimumSince">minimumSince</a></li><li data-type='method'><a href="items.ItemHistory.html#persist">persist</a></li><li data-type='method'><a href="items.ItemHistory.html#previousState">previousState</a></li><li data-type='method'><a href="items.ItemHistory.html#sumBetween">sumBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#sumSince">sumSince</a></li><li data-type='method'><a href="items.ItemHistory.html#updatedBetween">updatedBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#updatedSince">updatedSince</a></li><li data-type='method'><a href="items.ItemHistory.html#varianceBetween">varianceBetween</a></li><li data-type='method'><a href="items.ItemHistory.html#varianceSince">varianceSince</a></li></ul></li><li><a href="items.Item.html">Item</a><ul class='methods'><li data-type='method'><a href="items.Item.html#getMetadataValue">getMetadataValue</a></li><li data-type='method'><a href="items.Item.html#updateMetadataValue">updateMetadataValue</a></li><li data-type='method'><a href="items.Item.html#upsertMetadataValue">upsertMetadataValue</a></li><li data-type='method'><a href="items.Item.html#updateMetadataValues">updateMetadataValues</a></li><li data-type='method'><a href="items.Item.html#sendCommand">sendCommand</a></li><li data-type='method'><a href="items.Item.html#sendCommandIfDifferent">sendCommandIfDifferent</a></li><li data-type='method'><a href="items.Item.html#getToggleState">getToggleState</a></li><li data-type='method'><a href="items.Item.html#sendToggleCommand">sendToggleCommand</a></li><li data-type='method'><a href="items.Item.html#postToggleUpdate">postToggleUpdate</a></li><li data-type='method'><a href="items.Item.html#postUpdate">postUpdate</a></li><li data-type='method'><a href="items.Item.html#addGroups">addGroups</a></li><li data-type='method'><a href="items.Item.html#removeGroups">removeGroups</a></li><li data-type='method'><a href="items.Item.html#addTags">addTags</a></li><li data-type='method'><a href="items.Item.html#removeTags">removeTags</a></li></ul></li><li><a href="log.Logger.html">Logger</a><ul class='methods'><li data-type='method'><a href="log.Logger.html#error">error</a></li><li data-type='method'><a href="log.Logger.html#warn">warn</a></li><li data-type='method'><a href="log.Logger.html#info">info</a></li><li data-type='method'><a href="log.Logger.html#debug">debug</a></li><li data-type='method'><a href="log.Logger.html#trace">trace</a></li><li data-type='method'><a href="log.Logger.html#atLevel">atLevel</a></li></ul></li><li><a href="ConditionBuilder.html">ConditionBuilder</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.html#then">then</a></li><li data-type='method'><a href="ConditionBuilder.html#stateOfItem">stateOfItem</a></li></ul></li><li><a href="ConditionBuilder.ConditionConf.html">ConditionConf</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.ConditionConf.html#then">then</a></li></ul></li><li><a href="ConditionBuilder.FunctionConditionConf.html">FunctionConditionConf</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.FunctionConditionConf.html#then">then</a></li></ul></li><li><a href="ConditionBuilder.ItemStateConditionConf.html">ItemStateConditionConf</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.ItemStateConditionConf.html#is">is</a></li><li data-type='method'><a href="ConditionBuilder.ItemStateConditionConf.html#in">in</a></li><li data-type='method'><a href="ConditionBuilder.ItemStateConditionConf.html#then">then</a></li></ul></li><li><a href="OperationBuilder.html">OperationBuilder</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.html#build">build</a></li><li data-type='method'><a href="OperationBuilder.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.html#send">send</a></li><li data-type='method'><a href="OperationBuilder.html#postUpdate">postUpdate</a></li><li data-type='method'><a href="OperationBuilder.html#sendOn">sendOn</a></li><li data-type='method'><a href="OperationBuilder.html#sendOff">sendOff</a></li><li data-type='method'><a href="OperationBuilder.html#sendToggle">sendToggle</a></li><li data-type='method'><a href="OperationBuilder.html#sendIt">sendIt</a></li><li data-type='method'><a href="OperationBuilder.html#postIt">postIt</a></li><li data-type='method'><a href="OperationBuilder.html#copyState">copyState</a></li><li data-type='method'><a href="OperationBuilder.html#copyAndSendState">copyAndSendState</a></li></ul></li><li><a href="OperationBuilder.OperationConfig.html">OperationConfig</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.OperationConfig.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.OperationConfig.html#build">build</a></li></ul></li><li><a href="OperationBuilder.CopyStateOperation.html">CopyStateOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#fromItem">fromItem</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#toItem">toItem</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#and">and</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#build">build</a></li></ul></li><li><a href="OperationBuilder.SendCommandOrUpdateOperation.html">SendCommandOrUpdateOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#toItems">toItems</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#toItem">toItem</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#and">and</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#build">build</a></li></ul></li><li><a href="OperationBuilder.ToggleOperation.html">ToggleOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#toItem">toItem</a></li><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#and">and</a></li><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#doToggle">doToggle</a></li><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#build">build</a></li></ul></li><li><a href="OperationBuilder.TimingItemStateOperation.html">TimingItemStateOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.TimingItemStateOperation.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.TimingItemStateOperation.html#build">build</a></li></ul></li><li><a href="RuleBuilder.html">RuleBuilder</a><ul class='methods'><li data-type='method'><a href="RuleBuilder.html#when">when</a></li></ul></li><li><a href="TriggerBuilder.html">TriggerBuilder</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.html#channel">channel</a></li><li data-type='method'><a href="TriggerBuilder.html#cron">cron</a></li><li data-type='method'><a href="TriggerBuilder.html#item">item</a></li><li data-type='method'><a href="TriggerBuilder.html#memberOf">memberOf</a></li><li data-type='method'><a href="TriggerBuilder.html#thing">thing</a></li><li data-type='method'><a href="TriggerBuilder.html#system">system</a></li></ul></li><li><a href="TriggerBuilder.TriggerConf.html">TriggerConf</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.TriggerConf.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.TriggerConf.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.TriggerConf.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.ChannelTriggerConfig.html">ChannelTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#to">to</a></li><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#triggered">triggered</a></li><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.CronTriggerConfig.html">CronTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.CronTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.CronTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.CronTriggerConfig.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.ItemTriggerConfig.html">ItemTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#to">to</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#from">from</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#toOff">toOff</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#toOn">toOn</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#receivedCommand">receivedCommand</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#receivedUpdate">receivedUpdate</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#changed">changed</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#for">for</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.ThingTriggerConfig.html">ThingTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#changed">changed</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#updated">updated</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#from">from</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#to">to</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.SystemTriggerConfig.html">SystemTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#rulesLoaded">rulesLoaded</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#ruleEngineStarted">ruleEngineStarted</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#userInterfacesStarted">userInterfacesStarted</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#thingsInitialized">thingsInitialized</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#startupComplete">startupComplete</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#startLevel">startLevel</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#if">if</a></li></ul></li><li><a href="things.Thing.html">Thing</a><ul class='methods'><li data-type='method'><a href="things.Thing.html#setLabel">setLabel</a></li><li data-type='method'><a href="things.Thing.html#setLocation">setLocation</a></li><li data-type='method'><a href="things.Thing.html#setProperty">setProperty</a></li><li data-type='method'><a href="things.Thing.html#setEnabled">setEnabled</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#builder">builder</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">rules/trigger-builder.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const triggers = require('../triggers');
const operations = require('./operation-builder');
const conditions = require('./condition-builder');

/**
 * Builder for rule Triggers
 *
 * @hideconstructor
 */
class TriggerBuilder {
  constructor (builder) {
    this.builder = builder;
  }

  _setTrigger (trigger) {
    this.currentTigger = trigger;
    return this.currentTigger;
  }

  _or () {
    this.builder.addTrigger(this.currentTigger);
    return this;
  }

  _then (fn) {
    this._or();
    return new operations.OperationBuilder(this.builder, fn);
  }

  _if (fn) {
    this._or();
    return new conditions.ConditionBuilder(this.builder, fn);
  }

  /**
     * Specifies a channel event as a source for the rule to fire.
     *
     * @param {string} channelName the name of the channel
     * @returns {TriggerBuilder.ChannelTriggerConfig} the trigger config
     */
  channel (s) {
    return this._setTrigger(new ChannelTriggerConfig(s, this));
  }

  /**
     * Specifies a cron schedule for the rule to fire.
     *
     * @param {string} cronExpression the cron expression
     * @returns {TriggerBuilder.CronTriggerConfig} the trigger config
     */
  cron (s) {
    return this._setTrigger(new CronTriggerConfig(s, this));
  }

  /**
     * Specifies an item as the source of changes to trigger a rule.
     *
     * @param {string} itemName the name of the item
     * @returns {TriggerBuilder.ItemTriggerConfig} the trigger config
     */
  item (s) {
    return this._setTrigger(new ItemTriggerConfig(s, false, this));
  }

  /**
     * Specifies an group member as the source of changes to trigger a rule.
     *
     * @param {string} groupName the name of the group
     * @returns {TriggerBuilder.ItemTriggerConfig} the trigger config
     */
  memberOf (s) {
    return this._setTrigger(new ItemTriggerConfig(s, true, this));
  }

  /**
     * Specifies a Thing status event as a source for the rule to fire.
     *
     * @param {string} thingUID the UID of the Thing
     * @returns {TriggerBuilder.ThingTriggerConfig} the trigger config
     */
  thing (s) {
    return this._setTrigger(new ThingTriggerConfig(s, this));
  }

  /**
     * Specifies a system event as a source for the rule to fire.
     *
     * @memberof TriggerBuilder
     * @returns {TriggerBuilder.SystemTriggerConfig} the trigger config
     */
  system () {
    return this._setTrigger(new SystemTriggerConfig(this));
  }
}

/**
 * {RuleBuilder} RuleBuilder triggers
 * @memberof TriggerBuilder
 */
class TriggerConf {
  constructor (triggerBuilder) {
    this.triggerBuilder = triggerBuilder;
  }

  /**
     * Add an additional Trigger
     *
     * @returns {TriggerBuilder}
     */
  or () {
    return this.triggerBuilder._or();
  }

  /**
     * Move to the rule operations
     *
     * @param {*} function the optional function to execute
     * @returns {OperationBuilder}
     */
  then (fn) {
    return this.triggerBuilder._then(fn);
  }

  /**
     * Move to the rule condition
     *
     * @param {*} function the optional function to execute
     * @returns {ConditionBuilder}
     */
  if (fn) {
    return this.triggerBuilder._if(fn);
  }
}

/**
 * @memberof TriggerBuilder
 * @extends TriggerBuilder.TriggerConf
 * @hideconstructor
 */
class ChannelTriggerConfig extends TriggerConf {
  constructor (channelName, triggerBuilder) {
    super(triggerBuilder);
    this.channelName = channelName;
    this._toOHTriggers = () => [triggers.ChannelEventTrigger(this.channelName, this.eventName)];
  }

  describe (compact) {
    if (compact) {
      return this.channelName + (this.eventName ? `:${this.eventName}` : '');
    } else {
      return `matches channel "${this.channelName}"` + (this.eventName ? `for event ${this.eventName}` : '');
    }
  }

  /**
     * trigger a specific event name
     *
     * @param {string} eventName
     * @returns {TriggerBuilder.ChannelTriggerConfig}
     */
  to (eventName) {
    return this.triggered(eventName);
  }

  /**
     * trigger a specific event name
     *
     * @param {string} eventName
     * @returns {TriggerBuilder.ChannelTriggerConfig}
     */
  triggered (eventName) {
    this.eventName = eventName || '';
    return this;
  }

  _complete () {
    return typeof (this.eventName) !== 'undefined';
  }
}

/**
 * Cron based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerBuilder.TriggerConf
 * @hideconstructor
 */
class CronTriggerConfig extends TriggerConf {
  constructor (timeStr, triggerBuilder) {
    super(triggerBuilder);
    this.timeStr = timeStr;
    this._complete = () => true;
    this._toOHTriggers = () => [triggers.GenericCronTrigger(this.timeStr)];
    this.describe = (compact) => compact ? `cron_${this.timeStr}` : `matches cron "${this.timeStr}"`;
  }
}

/**
 * item based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerBuilder.TriggerConf
 * @hideconstructor
 */
class ItemTriggerConfig extends TriggerConf {
  constructor (itemOrName, isGroup, triggerBuilder) {
    super(triggerBuilder);
    this.type = isGroup ? 'memberOf' : 'item';
    if (typeof itemOrName !== 'string') {
      itemOrName = itemOrName.name;
    }

    this.item_name = itemOrName;
    this.describe = () => `${this.type} ${this.item_name} changed`;
    this.of = this.to; // receivedCommand().of(..)
  }

  /**
     * Item to
     *
     * @param {*} value this item should be triggered to
     * @returns {TriggerBuilder.ItemTriggerConfig}
     */
  to (value) {
    this.to_value = value;
    return this;
  }

  /**
     * Item from
     * @param {*} value this items should be triggered from
     * @returns {TriggerBuilder.ItemTriggerConfig}
     */
  from (value) {
    if (this.op_type !== 'changed') {
      throw Error('.from(..) only available for .changed()');
    }
    this.from_value = value;
    return this;
  }

  /**
     * item changed to OFF
     *
     * @returns {TriggerBuilder.ItemTriggerConfig}
     */
  toOff () {
    return this.to('OFF');
  }

  /**
     * item changed to ON
     *
     * @returns {TriggerBuilder.ItemTriggerConfig}
     */
  toOn () {
    return this.to('ON');
  }

  /**
     * item recieved command
     *
     * @returns {TriggerBuilder.ItemTriggerConfig}
     */
  receivedCommand () {
    this.op_type = 'receivedCommand';
    return this;
  }

  /**
     * item recieved update
     *
     * @returns {TriggerBuilder.ItemTriggerConfig}
     */
  receivedUpdate () {
    this.op_type = 'receivedUpdate';
    return this;
  }

  /**
     * item changed state
     *
     * @returns {TriggerBuilder.ItemTriggerConfig}
     */
  changed () {
    this.op_type = 'changed';
    return this;
  }

  /**
     * For timespan
     * @param {*} timespan
     * @returns {TriggerBuilder.ItemTriggerConfig}
     */
  for (timespan) {
    return new operations.TimingItemStateOperation(this, timespan);
  }

  _complete () {
    return typeof (this.op_type) !== 'undefined';
  }

  describe (compact) {
    switch (this.op_type) {
      case 'changed':
        if (compact) {
          let transition = this.from_value + '=>' || '';
          if (this.to_value) {
            transition = (transition || '=>') + this.to_value;
          }

          return `${this.item_name} ${transition}/Δ`;
        } else {
          let transition = 'changed';
          if (this.from_value) {
            transition += ` from ${this.from_value}`;
          }

          if (this.to_value) {
            transition += ` to ${this.to_value}`;
          }

          return `${this.item_name} ${transition}`;
        }
      case 'receivedCommand':
        return compact ? `${this.item_name}/⌘` : `${this.type} ${this.item_name} received command`;
      case 'receivedUpdate':
        return compact ? `${this.item_name}/↻` : `${this.type} ${this.item_name} received update`;
      default:
        throw Error('Unknown operation type: ' + this.op_type);
    }
  }

  _toOHTriggers () {
    if (this.type === 'memberOf') {
      switch (this.op_type) {
        case 'changed':
          return [triggers.GroupStateChangeTrigger(this.item_name, this.from_value, this.to_value)];
        case 'receivedCommand':
          return [triggers.GroupCommandTrigger(this.item_name, this.to_value)];
        case 'receivedUpdate':
          return [triggers.GroupStateUpdateTrigger(this.item_name, this.to_value)];
        default:
          throw Error('Unknown operation type: ' + this.op_type);
      }
    } else {
      switch (this.op_type) {
        case 'changed':
          return [triggers.ItemStateChangeTrigger(this.item_name, this.from_value, this.to_value)];
        case 'receivedCommand':
          return [triggers.ItemCommandTrigger(this.item_name, this.to_value)];
        case 'receivedUpdate':
          return [triggers.ItemStateUpdateTrigger(this.item_name, this.to_value)];
        default:
          throw Error('Unknown operation type: ' + this.op_type);
      }
    }
  }

  _executeHook () {
    const getReceivedCommand = function (args) {
      return args.receivedCommand;
    };

    if (this.op_type === 'receivedCommand') { // add the received command as 'it'
      return function (next, args) {
        const it = getReceivedCommand(args);
        return next({
          ...args,
          it
        });
      };
    } else {
      return null;
    }
  }
}

/**
 * Thing based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerBuilder.TriggerConf
 * @hideconstructor
 */
class ThingTriggerConfig extends TriggerConf {
  constructor (thingUID, triggerBuilder) {
    super(triggerBuilder);
    this.thingUID = thingUID;
  }

  _complete () {
    return typeof (this.op_type) !== 'undefined';
  }

  describe (compact) {
    switch (this.op_type) {
      case 'changed':
        let transition = 'changed'; // eslint-disable-line no-case-declarations

        if (this.to_value) {
          transition += ` to ${this.to_value}`;
        }

        if (this.from_value) {
          transition += ` from ${this.from_value}`;
        }

        return `${this.thingUID} ${transition}`;
      case 'updated':
        return compact ? `${this.thingUID}/updated` : `Thing ${this.thingUID} received update`;
      default:
        throw Error('Unknown operation type: ' + this.op_type);
    }
  }

  /**
     * thing changed
     *
     * @returns {TriggerBuilder.ThingTriggerConfig}
     */
  changed () {
    this.op_type = 'changed';
    return this;
  }

  /**
     * thing updates
     *
     * @returns {TriggerBuilder.ThingTriggerConfig}
     */
  updated () {
    this.op_type = 'updated';
    return this;
  }

  /**
     * thing status changed from
     *
     * @returns {TriggerBuilder.ThingTriggerConfig}
     */
  from (value) {
    if (this.op_type !== 'changed') {
      throw Error('.from(..) only available for .changed()');
    }
    this.from_value = value;
    return this;
  }

  /**
     * thing status changed to
     *
     * @returns {TriggerBuilder.ThingTriggerConfig}
     */
  to (value) {
    this.to_value = value;
    return this;
  }

  _toOHTriggers () {
    switch (this.op_type) {
      case 'changed':
        return [triggers.ThingStatusChangeTrigger(this.thingUID, this.to_value, this.from_value)];
      case 'updated':
        return [triggers.ThingStatusUpdateTrigger(this.thingUID, this.to_value)];
      default:
        throw Error('Unknown operation type: ' + this.op_type);
    }
  }
}

/**
 * System based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerBuilder.TriggerConf
 * @hideconstructor
 */
class SystemTriggerConfig extends TriggerConf {
  constructor (triggerBuilder) {
    super(triggerBuilder);
    this._toOHTriggers = () => [triggers.SystemStartlevelTrigger(this.level)];
    this.describe = (compact) => compact ? `system:${this.level}` : `system level "${this.level}"`;
  }

  _complete () {
    return typeof (this.level) !== 'undefined';
  }

  /**
     * System trigger
     *
     * @returns {TriggerBuilder.SystemTriggerConfig}
     */
  rulesLoaded () {
    return this.startLevel(40);
  }

  /**
     * System trigger
     *
     * @returns {TriggerBuilder.SystemTriggerConfig}
     */
  ruleEngineStarted () {
    return this.startLevel(50);
  }

  /**
     * System trigger
     *
     * @returns {TriggerBuilder.SystemTriggerConfig}
     */
  userInterfacesStarted () {
    return this.startLevel(70);
  }

  /**
     * System trigger
     *
     * @returns {TriggerBuilder.SystemTriggerConfig}
     */
  thingsInitialized () {
    return this.startLevel(80);
  }

  /**
     * System trigger
     *
     * @returns {TriggerBuilder.SystemTriggerConfig}
     */
  startupComplete () {
    return this.startLevel(100);
  }

  /**
     * System trigger
     *
     * @returns {TriggerBuilder.SystemTriggerConfig}
     */
  startLevel (level) {
    if (typeof (this.level) !== 'undefined') {
      throw Error('Level already set');
    }
    this.level = level;
    return this;
  }
}

module.exports = {
  CronTriggerConfig,
  ChannelTriggerConfig,
  ItemTriggerConfig,
  ThingTriggerConfig,
  SystemTriggerConfig,
  TriggerBuilder
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a> on Wed Oct 12 2022 20:15:00 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
